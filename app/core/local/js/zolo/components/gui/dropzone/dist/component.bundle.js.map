{"version":3,"file":"component.bundle.js","sources":["../../../../stores/dropzoneStore.js","../src/component.js"],"sourcesContent":["import {defineStore} from 'ui.vue3.pinia';\n\nexport const useDropzoneStore = defineStore('dropzone', {\n    actions: {\n        async uploadFile(files) {\n            return await BX.ajax.runComponentAction('zolo:dropzone', 'upload', {\n                mode: 'class',\n                data: files,\n            });\n        },\n        async deleteFile(id) {\n            return await BX.ajax.runComponentAction('zolo:dropzone', 'delete', {\n                mode: 'class',\n                data: { id },\n            });\n        },\n    },\n})","import {useDropzoneStore} from \"../../../../stores/dropzoneStore\";\n\nlet id = 0;\n\nexport const Dropzone = {\n    props: {\n        files: {\n            type: Array,\n            default: [],\n        },\n        formats: {\n            type: String,\n            default: '.pdf,.jpg,.jpeg,.png',\n        },\n        editing: {\n            type: Boolean,\n            default: false,\n        },\n        maxFiles: {\n            type: Number,\n            default: 10,\n        },\n    },\n\n    data() {\n        return {\n            componentId: 'dropzone-' + ++id,\n        };\n    },\n\n    setup () {\n        return { store: useDropzoneStore() };\n    },\n\n    methods: {\n        async uploadFile(event) {\n            let totalFilesCount = this.files.length;\n            if (totalFilesCount >= this.maxFiles) {\n                return;\n            }\n            const data = new FormData();\n            for (let i = 0; i < event.target.files.length; i++) {\n                data.append(`file-${i}`, event.target.files[i]);\n                totalFilesCount += 1;\n                if (totalFilesCount >= this.maxFiles) {\n                    break;\n                }\n            }\n            const response = await this.store.uploadFile(data);\n            if (response.data.length > 0) {\n                for (const fileInfo of response.data) {\n                    this.files.push(fileInfo);\n                }\n                this.$emit('upload', response.data);\n            }\n        },\n        deleteFile(file) {\n            // this.store.deleteFile(file.id); Файлы не удаляются т.к. они нужны для тикетов тех поддержки\n            this.files.splice(this.files.indexOf(file), 1);\n            if (file.id > 0) {\n                this.$emit('delete', file.id);\n            }\n        },\n    },\n\n    template: `\n      <div v-if=\"!editing && !files.length\" class=\"profile__notification\">\n        <span class=\"profile__notification-icon\">\n            <svg class=\"icon icon--danger\">\n                <use xlink:href=\"/local/templates/.default/images/icons/sprite.svg#icon-danger\"></use>\n            </svg>\n        </span>\n        <p class=\"profile__notification-text\">Необходимо приложить документы. Войдите в режим редактирования.</p>\n      </div>\n      \n      <div class=\"dropzone\">\n          <input \n          type=\"file\" \n          ref=\"file\" \n          :name=\"componentId\" \n          :id=\"componentId\" \n          multiple \n          class=\"dropzone__control\" \n          @change=\"uploadFile($event)\" \n          :accept=\"formats\"\n          >\n          <div class=\"dropzone__area\">\n            <div class=\"profile__toggle dropzone__message dz-message needsclick\">\n              <label :for=\"componentId\" class=\"dropzone__button dropzone__button--profile button button--medium button--rounded button--covered button--red\">\n                    <span class=\"button__icon\">\n                        <svg class=\"icon icon--import\">\n                            <use xlink:href=\"/local/templates/.default/images/icons/sprite.svg#icon-import\"></use>\n                        </svg>\n                    </span>\n                <span class=\"button__text\">Загрузить файл</span>\n              </label>\n            </div>\n    \n            <div class=\"dropzone__previews dropzone__previews--profile dz-previews\">\n              <div v-for=\"file in files\" :key=\"file.id\" class=\"file dz-processing dz-image-preview dz-success dz-complete\">\n                <div class=\"file__wrapper\">\n                  <div class=\"file__prewiew\">\n                    <div class=\"file__icon\">\n                      <svg class=\"icon icon--gallery\">\n                        <use xlink:href=\"/local/templates/.default/images/icons/sprite.svg#icon-gallery\"></use>\n                      </svg>\n                    </div>\n    \n                    <div class=\"file__name\">\n                      <h6 class=\"file__name-heading heading heading--tiny\">{{ file.name }}</h6>\n                    </div>\n                  </div>\n    \n                  <div class=\"file__info\">\n                    <div class=\"file__format\">{{ file.format }}</div>\n                    <div class=\"file__weight\">{{ file.size }}</div>\n    \n                    <div v-if=\"editing\" class=\"file__delete\">\n                      <button type=\"button\" class=\"file__delete-button button button--iconed button--simple button--gray\" @click=\"deleteFile(file)\">\n                        <span class=\"file__delete-button-icon button__icon\">\n                            <svg class=\"icon icon--delete\">\n                                <use xlink:href=\"/local/templates/.default/images/icons/sprite.svg#icon-delete\"></use>\n                            </svg>\n                        </span>\n                      </button>\n                    </div>\n                    <div v-else class=\"file__upload\">\n                      <a class=\"button button--iconed button--simple button--gray\" :href=\"file.src\" download>\n                        <span class=\"button__icon\">\n                            <svg class=\"icon icon--import\">\n                                <use xlink:href=\"/local/templates/.default/images/icons/sprite.svg#icon-import\"></use>\n                            </svg>\n                        </span>\n                      </a>\n                    </div>\n                  </div>\n                </div>\n                <div class=\"file__error\" data-dz-errormessage=\"\">{{ file.error }}</div>\n              </div>\n            </div>\n          </div>\n      </div>\n    `,\n};"],"names":["useDropzoneStore","defineStore","actions","uploadFile","files","BX","ajax","runComponentAction","mode","data","deleteFile","id","Dropzone","props","type","Array","formats","String","editing","Boolean","maxFiles","Number","componentId","setup","store","methods","event","totalFilesCount","length","FormData","i","target","append","response","fileInfo","push","$emit","file","splice","indexOf","template"],"mappings":"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"}