{"version":3,"file":"component.bundle.js","sources":["../../../../stores/dropzoneStore.js","../src/component.js"],"sourcesContent":["import {defineStore} from 'ui.vue3.pinia';\n\nexport const useDropzoneStore = defineStore('dropzone', {\n    actions: {\n        async uploadFile(files) {\n            return await BX.ajax.runComponentAction('zolo:dropzone', 'upload', {\n                mode: 'class',\n                data: files,\n            });\n        },\n        async deleteFile(id) {\n            return await BX.ajax.runComponentAction('zolo:dropzone', 'delete', {\n                mode: 'class',\n                data: { id },\n            });\n        },\n    },\n})","import {useDropzoneStore} from \"../../../../stores/dropzoneStore\";\n\nlet id = 0;\n\nexport const Dropzone = {\n    props: {\n        files: {\n            type: Array,\n            default: [],\n        },\n        editing: {\n            type: Boolean,\n            default: false,\n        },\n    },\n\n    data() {\n        return {\n            componentId: 'dropzone-' + ++id,\n        };\n    },\n\n    setup () {\n        return { store: useDropzoneStore() };\n    },\n\n    methods: {\n        async uploadFile(event) {\n            const data = new FormData();\n            for (let i = 0; i < event.target.files.length; i++) {\n                data.append(`file-${i}`, event.target.files[i]);\n            }\n            const response = await this.store.uploadFile(data);\n            for (const fileInfo of response.data) {\n                this.files.push(fileInfo);\n            }\n            this.$emit('upload', response.data);\n        },\n        deleteFile(file) {\n            // this.store.deleteFile(file.id); Файлы не удаляются т.к. они нужны для тикетов тех поддержки\n            this.files.splice(this.files.indexOf(file), 1);\n            this.$emit('delete', file.id);\n        },\n    },\n\n    template: `\n      <div v-if=\"!editing && !files.length\" class=\"profile__notification\">\n        <span class=\"profile__notification-icon\">\n            <svg class=\"icon icon--danger\">\n                <use xlink:href=\"/local/templates/.default/images/icons/sprite.svg#icon-danger\"></use>\n            </svg>\n        </span>\n        <p class=\"profile__notification-text\">Необходимо приложить документы. Войдите в режим редактирования.</p>\n      </div>\n      \n      <div class=\"dropzone\">\n          <input type=\"file\" ref=\"file\" :name=\"componentId\" :id=\"componentId\" multiple class=\"dropzone__control\" @change=\"uploadFile($event)\">\n          <div class=\"dropzone__area\">\n            <div class=\"profile__toggle dropzone__message dz-message needsclick\">\n              <label :for=\"componentId\" class=\"dropzone__button dropzone__button--profile button button--medium button--rounded button--covered button--red\">\n                    <span class=\"button__icon\">\n                        <svg class=\"icon icon--import\">\n                            <use xlink:href=\"/local/templates/.default/images/icons/sprite.svg#icon-import\"></use>\n                        </svg>\n                    </span>\n                <span class=\"button__text\">Загрузить файл</span>\n              </label>\n            </div>\n    \n            <div class=\"dropzone__previews dropzone__previews--profile dz-previews\">\n              <div v-for=\"file in files\" :key=\"file.id\" class=\"file dz-processing dz-image-preview dz-success dz-complete\">\n                <div class=\"file__wrapper\">\n                  <div class=\"file__prewiew\">\n                    <div class=\"file__icon\">\n                      <svg class=\"icon icon--gallery\">\n                        <use xlink:href=\"/local/templates/.default/images/icons/sprite.svg#icon-gallery\"></use>\n                      </svg>\n                    </div>\n    \n                    <div class=\"file__name\">\n                      <h6 class=\"file__name-heading heading heading--tiny\">{{ file.name }}</h6>\n                    </div>\n                  </div>\n    \n                  <div class=\"file__info\">\n                    <div class=\"file__format\">{{ file.src.slice(-5) == '.heic' ? 'HEIC' : file.format }}</div>\n                    <div class=\"file__weight\">{{ file.size }}</div>\n    \n                    <div v-if=\"editing\" class=\"file__delete\">\n                      <button type=\"button\" class=\"file__delete-button button button--iconed button--simple button--gray\" @click=\"deleteFile(file)\">\n                        <span class=\"file__delete-button-icon button__icon\">\n                            <svg class=\"icon icon--delete\">\n                                <use xlink:href=\"/local/templates/.default/images/icons/sprite.svg#icon-delete\"></use>\n                            </svg>\n                        </span>\n                      </button>\n                    </div>\n                    <div v-else class=\"file__upload\">\n                      <a class=\"button button--iconed button--simple button--gray\" :href=\"file.src\" download>\n                        <span class=\"button__icon\">\n                            <svg class=\"icon icon--import\">\n                                <use xlink:href=\"/local/templates/.default/images/icons/sprite.svg#icon-import\"></use>\n                            </svg>\n                        </span>\n                      </a>\n                    </div>\n                  </div>\n                </div>\n                <div class=\"file__error\"></div>\n              </div>\n            </div>\n          </div>\n      </div>\n    `,\n};"],"names":["useDropzoneStore","defineStore","actions","uploadFile","files","BX","ajax","runComponentAction","mode","data","deleteFile","id","Dropzone","props","type","Array","editing","Boolean","componentId","setup","store","methods","event","FormData","i","target","length","append","response","fileInfo","push","$emit","file","splice","indexOf","template"],"mappings":";;;;;IAEO,IAAMA,gBAAgB,GAAGC,yBAAW,CAAC,UAAD,EAAa;MACpDC,OAAO,EAAE;QACCC,UADD,sBACYC,KADZ,EACmB;UAAA;YAAA;cAAA;gBAAA;kBAAA;oBAAA;oBAAA,OACPC,EAAE,CAACC,IAAH,CAAQC,kBAAR,CAA2B,eAA3B,EAA4C,QAA5C,EAAsD;sBAC/DC,IAAI,EAAE,OADyD;sBAE/DC,IAAI,EAAEL;qBAFG,CADO;;kBAAA;oBAAA;;kBAAA;kBAAA;oBAAA;;;;;SADnB;QAOCM,UAPD,sBAOYC,EAPZ,EAOgB;UAAA;YAAA;cAAA;gBAAA;kBAAA;oBAAA;oBAAA,OACJN,EAAE,CAACC,IAAH,CAAQC,kBAAR,CAA2B,eAA3B,EAA4C,QAA5C,EAAsD;sBAC/DC,IAAI,EAAE,OADyD;sBAE/DC,IAAI,EAAE;wBAAEE,EAAE,EAAFA;;qBAFC,CADI;;kBAAA;oBAAA;;kBAAA;kBAAA;oBAAA;;;;;;;IAR2B,CAAb,CAApC;;;;;;;;;ICAP,IAAIA,EAAE,GAAG,CAAT;AAEA,QAAaC,QAAQ,GAAG;MACpBC,KAAK,EAAE;QACHT,KAAK,EAAE;UACHU,IAAI,EAAEC,KADH;UAEH,WAAS;SAHV;QAKHC,OAAO,EAAE;UACLF,IAAI,EAAEG,OADD;UAEL,WAAS;;OARG;MAYpBR,IAZoB,kBAYb;QACH,OAAO;UACHS,WAAW,EAAE,cAAc,EAAEP;SADjC;OAbgB;MAkBpBQ,KAlBoB,mBAkBX;QACL,OAAO;UAAEC,KAAK,EAAEpB,gBAAgB;SAAhC;OAnBgB;MAsBpBqB,OAAO,EAAE;QACClB,UADD,sBACYmB,KADZ,EACmB;UAAA;;UAAA;YAAA;;YAAA;cAAA;gBAAA;kBAAA;oBACdb,IADc,GACP,IAAIc,QAAJ,EADO;;oBAEpB,KAASC,CAAT,GAAa,CAAb,EAAgBA,CAAC,GAAGF,KAAK,CAACG,MAAN,CAAarB,KAAb,CAAmBsB,MAAvC,EAA+CF,CAAC,EAAhD,EAAoD;sBAChDf,IAAI,CAACkB,MAAL,gBAAoBH,CAApB,GAAyBF,KAAK,CAACG,MAAN,CAAarB,KAAb,CAAmBoB,CAAnB,CAAzB;;;oBAHgB;oBAAA,OAKG,KAAI,CAACJ,KAAL,CAAWjB,UAAX,CAAsBM,IAAtB,CALH;;kBAAA;oBAKdmB,QALc;oBAAA,uCAMGA,QAAQ,CAACnB,IANZ;;oBAAA;sBAMpB,oDAAsC;wBAA3BoB,QAA2B;;wBAClC,KAAI,CAACzB,KAAL,CAAW0B,IAAX,CAAgBD,QAAhB;;;sBAPgB;;sBAAA;;;oBASpB,KAAI,CAACE,KAAL,CAAW,QAAX,EAAqBH,QAAQ,CAACnB,IAA9B;;kBAToB;kBAAA;oBAAA;;;;;SADnB;QAYLC,UAZK,sBAYMsB,IAZN,EAYY;;UAEb,KAAK5B,KAAL,CAAW6B,MAAX,CAAkB,KAAK7B,KAAL,CAAW8B,OAAX,CAAmBF,IAAnB,CAAlB,EAA4C,CAA5C;UACA,KAAKD,KAAL,CAAW,QAAX,EAAqBC,IAAI,CAACrB,EAA1B;;OArCY;MAyCpBwB,QAAQ;IAzCY,CAAjB;;;;;;;;"}