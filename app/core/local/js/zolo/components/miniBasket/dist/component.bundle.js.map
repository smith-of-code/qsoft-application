{"version":3,"file":"component.bundle.js","sources":["../../../stores/basketStore.js","../../../mixins/NumberFormatMixin.js","../src/component.js"],"sourcesContent":["import {defineStore} from 'ui.vue3.pinia';\n\nexport const useBasketStore = defineStore('basket', {\n    state: () => ({\n        fetched: false,\n        items: {},\n        itemsCount: undefined,\n        basketPrice: undefined,\n        loading: false,\n    }),\n    actions: {\n        async getItem(id) {\n            if (!this.fetched) {\n                await this.fetchBasketTotals();\n                this.fetched = true;\n            }\n            return this.items[id];\n        },\n        async fetchBasketTotals() {\n            if (!this.fetched) {\n                this.loading = true;\n                try {\n                    const response = await BX.ajax.runComponentAction('zolo:sale.basket.basket.line', 'getBasketTotals', {\n                        data: { withPersonalPromotions: window.location.pathname === '/cart/' || window.location.pathname === '/order/make/' },\n                    }).then((response) => response.data);\n\n                    this.items = response.items;\n                    this.itemsCount = response.itemsCount;\n                    this.basketPrice = response.basketPrice;\n                } finally {\n                    this.loading = false;\n                }\n                this.fetched = true;\n            }\n        },\n        async increaseItem(offerId, detailPage = '', nonreturnable = false) {\n            this.loading = true;\n            try {\n                const response = await BX.ajax.runComponentAction('zolo:sale.basket.basket.line', 'increaseItem', {\n                    data: {\n                        offerId,\n                        detailPage,\n                        nonreturnable,\n                        withPersonalPromotions: window.location.pathname === '/cart/',\n                    }\n                }).then((response) => response.data);\n\n                this.items = response.items;\n                this.itemsCount = response.itemsCount;\n                this.basketPrice = response.basketPrice;\n            } finally {\n                this.loading = false;\n            }\n        },\n        async decreaseItem(offerId, quantity = 1) {\n            this.loading = true;\n            try {\n                const response = await BX.ajax.runComponentAction('zolo:sale.basket.basket.line', 'decreaseItem', {\n                    data: { offerId, quantity, withPersonalPromotions: window.location.pathname === '/cart/' }\n                }).then((response) => response.data);\n\n                this.items = response.items;\n                this.itemsCount = response.itemsCount;\n                this.basketPrice = response.basketPrice;\n            } finally {\n                this.loading = false;\n            }\n        },\n        async repeatOrder() {\n            const response = await BX.ajax.runComponentAction('zolo:sale.basket.basket.line', 'repeatOrder', {\n                data: { orderId },\n            }).then((response) => response.data);\n            this.items = response.items;\n            this.itemsCount = response.itemsCount;\n            this.basketPrice = response.basketPrice;\n\n            return response.missedProducts;\n        },\n    },\n})","export default {\n    methods: {\n        formatNumber(number, useDecimals = false) {\n            if (!number) return 0;\n            number = Math.round(parseFloat(number));\n            let result = number.toFixed(2).replace(/\\d(?=(\\d{3})+\\.)/g, '$&\\u00A0');\n            return useDecimals ? result : result.substring(0, result.length - 3);\n        },\n    },\n};\n","import {useBasketStore} from \"../../../stores/basketStore\";\nimport {computed} from \"ui.vue3\";\nimport NumberFormatMixin from \"../../../mixins/NumberFormatMixin\";\n\nexport const MiniBasket = {\n    mixins: [NumberFormatMixin],\n\n    data() {\n        return {}\n    },\n\n    setup() {\n        const store = useBasketStore();\n        store.fetchBasketTotals();\n        return {\n            itemsCount: computed(() => store.itemsCount),\n            basketPrice: computed(() => store.basketPrice)\n        }\n    },\n\n    methods: {\n      showPriceWhole(item) {\n          const number = parseFloat(item);\n          const numberFloor = Math.floor(number);\n          return numberFloor.toLocaleString('ru-RU', {minimumFractionDigits: 0});\n      },\n\n      showPriceRemains(item) {\n          const number = parseFloat(item);\n          const numberFixed = number.toFixed(2);\n          const totalRemains = numberFixed.toString().split('.')[1];\n         \n          if (totalRemains === \"00\") {\n              return \n          } else {\n              return ',' + totalRemains\n          }\n      }\n    },\n    \n    template: `\n      <button type=\"button\" class=\"button button--simple button--red button--vertical\">\n      <span class=\"button__icon button__icon--mixed\">\n        <svg class=\"icon icon--basket\">\n          <use xlink:href=\"/local/templates/.default/images/icons/sprite.svg#icon-basket\"></use>\n        </svg>\n        <span v-if=\"itemsCount\" class=\"button__icon-counter button__icon-counter--dark\">{{ itemsCount }}</span>\n        </span>\n      <span v-if=\"itemsCount\" class=\"personal__button-text button__text\">\n        <span class=\"personal__price-whole\">\n            {{ showPriceWhole(basketPrice) }}\n        </span>\n        <span class=\"personal__price-remains\">\n            {{ showPriceRemains(basketPrice) }}&nbsp;&#8381\n        </span>\n      </span>\n      <span v-else class=\"personal__button-text button__text\">Корзина</span>\n      </button>\n    `\n};"],"names":["useBasketStore","defineStore","state","fetched","items","itemsCount","undefined","basketPrice","loading","actions","getItem","id","fetchBasketTotals","BX","ajax","runComponentAction","data","withPersonalPromotions","window","location","pathname","then","response","increaseItem","offerId","detailPage","nonreturnable","decreaseItem","quantity","repeatOrder","orderId","missedProducts","methods","formatNumber","number","useDecimals","Math","round","parseFloat","result","toFixed","replace","substring","length","MiniBasket","mixins","NumberFormatMixin","setup","store","computed","showPriceWhole","item","numberFloor","floor","toLocaleString","minimumFractionDigits","showPriceRemains","numberFixed","totalRemains","toString","split","template"],"mappings":"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"}